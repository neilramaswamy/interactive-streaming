import { motion } from "framer-motion";
import { useEffect } from "react";
import { SceneProps } from "./types";

const SHOT_AXIS = 0;
const SHOT_DISTRIBUTION = 1;
const SHOT_PERCENTILE_TICK = 2;
const SHOT_FILL = 3;

const NUM_SHOTS = 4;

export const DelayDistribution = (props: SceneProps): JSX.Element => {
  const { shotIndex, onSceneComplete } = props;

  useEffect(() => {
    if (shotIndex === NUM_SHOTS) {
      onSceneComplete();
    }
  }, [shotIndex, onSceneComplete]);

  return (
    <motion.svg
      className="self-center"
      width="800"
      height="600"
      viewBox="0 0 800 600"
    >
      {/* Y-axis */}
      <motion.text
        x={0}
        y={375}
        stroke="white"
        initial={{ opacity: 0 }}
        animate={{ opacity: +(shotIndex >= SHOT_AXIS) }}
      >
        Probability
      </motion.text>
      <motion.line
        stroke={"rgb(  255, 255, 255)"}
        initial={{
          x1: 105,
          y1: 528,
          x2: 105,
          y2: 100,
          pathLength: 0,
        }}
        animate={{ pathLength: 1 }}
      />
      {/* X axis label... these offsets are hacks! They are manually calculated. */}
      <motion.text
        x={425}
        y={560}
        stroke="white"
        initial={{ opacity: 0 }}
        animate={{ opacity: +(shotIndex >= SHOT_AXIS) }}
      >
        Delay
      </motion.text>

      <motion.line
        stroke={"rgb(  255, 255, 255)"}
        initial={{
          x1: 105,
          y1: 528,
          x2: 800,
          y2: 528,
          pathLength: 0,
        }}
        animate={{ pathLength: 1 }}
      />

      {/* Percentile tick marks */}
      <motion.line
        stroke="#ff0000"
        initial={{
          x1: 450,
          y1: 528,
          x2: 450,
          y2: 100,
          pathLength: 0,
        }}
        strokeWidth={2}
        animate={{ pathLength: +(shotIndex >= SHOT_PERCENTILE_TICK) }}
      />

      {/* https://upload.wikimedia.org/wikipedia/commons/e/e6/Gamma_distribution_pdf.svg */}
      <motion.path
        xmlns="http://www.w3.org/2000/svg"
        stroke="rgb(  255, 255, 255)"
        fill="transparent"
        // Warning!! We _need_ to use hex codes here for the animation to work.
        initial={{ pathLength: 0, fill: "#000000" }}
        animate={{
          pathLength: +(shotIndex >= SHOT_DISTRIBUTION),
          transition: { duration: +(shotIndex <= SHOT_DISTRIBUTION) ? 2 : 1 },
          // Warning!! We _need_ to use hex codes here for the animation to work.
          fill: +(shotIndex >= SHOT_FILL) ? "#ff0000" : "#000000",
        }}
        d="M108.5,528.0 L109.1,528.0 L109.8,528.0 L110.4,528.0 L111.1,528.0 L111.7,528.0    L112.3,528.0 L113.0,528.0 L113.6,528.0 L114.3,528.0 L114.9,528.0 L115.6,528.0 L116.2,528.0 L116.8,528.0    L117.5,528.0 L118.1,528.0 L118.8,528.0 L119.4,528.0 L120.0,528.0 L120.7,528.0 L121.3,528.0 L122.0,528.0    L122.6,528.0 L123.2,528.0 L123.9,528.0 L124.5,528.0 L125.2,528.0 L125.8,528.0 L126.5,528.0 L127.1,527.9    L127.7,527.9 L128.4,527.9 L129.0,527.9 L129.7,527.9 L130.3,527.9 L130.9,527.8 L131.6,527.8 L132.2,527.7    L132.9,527.7 L133.5,527.6 L134.2,527.6 L134.8,527.5 L135.4,527.4 L136.1,527.3 L136.7,527.2 L137.4,527.1    L138.0,527.0 L138.6,526.8 L139.3,526.7 L139.9,526.5 L140.6,526.3 L141.2,526.1 L141.8,525.9 L142.5,525.6    L143.1,525.3 L143.8,525.0 L144.4,524.7 L145.1,524.3 L145.7,524.0 L146.3,523.5 L147.0,523.1 L147.6,522.6    L148.3,522.1 L148.9,521.6 L149.5,521.0 L150.2,520.4 L150.8,519.7 L151.5,519.0 L152.1,518.3 L152.7,517.5    L153.4,516.7 L154.0,515.9 L154.7,515.0 L155.3,514.0 L156.0,513.0 L156.6,512.0 L157.2,510.9 L157.9,509.7    L158.5,508.5 L159.2,507.3 L159.8,506.0 L160.4,504.7 L161.1,503.3 L161.7,501.8 L162.4,500.3 L163.0,498.8    L163.7,497.2 L164.3,495.5 L164.9,493.8 L165.6,492.0 L166.2,490.2 L166.9,488.3 L167.5,486.4 L168.1,484.4    L168.8,482.4 L169.4,480.3 L170.1,478.2 L170.7,476.0 L171.3,473.7 L172.0,471.4 L172.6,469.1 L173.3,466.7    L173.9,464.3 L174.6,461.8 L175.2,459.3 L175.8,456.8 L176.5,454.2 L177.1,451.5 L177.8,448.9 L178.4,446.1    L179.0,443.4 L179.7,440.6 L180.3,437.8 L181.0,434.9 L181.6,432.1 L182.2,429.1 L182.9,426.2 L183.5,423.2    L184.2,420.3 L184.8,417.3 L185.5,414.2 L186.1,411.2 L186.7,408.1 L187.4,405.1 L188.0,402.0 L188.7,398.9    L189.3,395.8 L189.9,392.7 L190.6,389.6 L191.2,386.4 L191.9,383.3 L192.5,380.2 L193.2,377.1 L193.8,374.0    L194.4,370.9 L195.1,367.8 L195.7,364.7 L196.4,361.7 L197.0,358.6 L197.6,355.6 L198.3,352.5 L198.9,349.5    L199.6,346.6 L200.2,343.6 L200.8,340.7 L201.5,337.8 L202.1,334.9 L202.8,332.1 L203.4,329.3 L204.1,326.5    L204.7,323.8 L205.3,321.1 L206.0,318.4 L206.6,315.8 L207.3,313.2 L207.9,310.6 L208.5,308.1 L209.2,305.7    L209.8,303.2 L210.5,300.9 L211.1,298.6 L211.7,296.3 L212.4,294.1 L213.0,291.9 L213.7,289.8 L214.3,287.7    L215.0,285.7 L215.6,283.8 L216.2,281.8 L216.9,280.0 L217.5,278.2 L218.2,276.5 L218.8,274.8 L219.4,273.2    L220.1,271.6 L220.7,270.1 L221.4,268.7 L222.0,267.3 L222.7,266.0 L223.3,264.7 L223.9,263.5 L224.6,262.3    L225.2,261.3 L225.9,260.2 L226.5,259.3 L227.1,258.4 L227.8,257.5 L228.4,256.7 L229.1,256.0 L229.7,255.3    L230.3,254.7 L231.0,254.2 L231.6,253.7 L232.3,253.3 L232.9,252.9 L233.6,252.6 L234.2,252.3 L234.8,252.1    L235.5,252.0 L236.1,251.9 L236.8,251.9 L237.4,251.9 L238.0,252.0 L238.7,252.1 L239.3,252.3 L240.0,252.6    L240.6,252.9 L241.2,253.2 L241.9,253.6 L242.5,254.1 L243.2,254.6 L243.8,255.1 L244.5,255.7 L245.1,256.3    L245.7,257.0 L246.4,257.8 L247.0,258.5 L247.7,259.3 L248.3,260.2 L248.9,261.1 L249.6,262.1 L250.2,263.1    L250.9,264.1 L251.5,265.1 L252.2,266.2 L252.8,267.4 L253.4,268.6 L254.1,269.8 L254.7,271.0 L255.4,272.3    L256.0,273.6 L256.6,275.0 L257.3,276.3 L257.9,277.7 L258.6,279.2 L259.2,280.6 L259.8,282.1 L260.5,283.6    L261.1,285.2 L261.8,286.7 L262.4,288.3 L263.1,289.9 L263.7,291.6 L264.3,293.2 L265.0,294.9 L265.6,296.6    L266.3,298.3 L266.9,300.0 L267.5,301.7 L268.2,303.5 L268.8,305.3 L269.5,307.1 L270.1,308.9 L270.7,310.7    L271.4,312.5 L272.0,314.3 L272.7,316.2 L273.3,318.1 L274.0,319.9 L274.6,321.8 L275.2,323.7 L275.9,325.6    L276.5,327.5 L277.2,329.4 L277.8,331.3 L278.4,333.2 L279.1,335.1 L279.7,337.0 L280.4,338.9 L281.0,340.8    L281.7,342.8 L282.3,344.7 L282.9,346.6 L283.6,348.5 L284.2,350.4 L284.9,352.4 L285.5,354.3 L286.1,356.2    L286.8,358.1 L287.4,360.0 L288.1,361.9 L288.7,363.8 L289.3,365.7 L290.0,367.6 L290.6,369.5 L291.3,371.3    L291.9,373.2 L292.6,375.1 L293.2,376.9 L293.8,378.7 L294.5,380.6 L295.1,382.4 L295.8,384.2 L296.4,386.0    L297.0,387.8 L297.7,389.6 L298.3,391.4 L299.0,393.2 L299.6,394.9 L300.2,396.7 L300.9,398.4 L301.5,400.1    L302.2,401.8 L302.8,403.5 L303.5,405.2 L304.1,406.9 L304.7,408.5 L305.4,410.2 L306.0,411.8 L306.7,413.5    L307.3,415.1 L307.9,416.7 L308.6,418.2 L309.2,419.8 L309.9,421.4 L310.5,422.9 L311.2,424.4 L311.8,426.0    L312.4,427.5 L313.1,428.9 L313.7,430.4 L314.4,431.9 L315.0,433.3 L315.6,434.7 L316.3,436.1 L316.9,437.5    L317.6,438.9 L318.2,440.3 L318.8,441.7 L319.5,443.0 L320.1,444.3 L320.8,445.6 L321.4,446.9 L322.1,448.2    L322.7,449.5 L323.3,450.7 L324.0,452.0 L324.6,453.2 L325.3,454.4 L325.9,455.6 L326.5,456.8 L327.2,457.9    L327.8,459.1 L328.5,460.2 L329.1,461.4 L329.7,462.5 L330.4,463.6 L331.0,464.6 L331.7,465.7 L332.3,466.8    L333.0,467.8 L333.6,468.8 L334.2,469.8 L334.9,470.8 L335.5,471.8 L336.2,472.8 L336.8,473.7 L337.4,474.7    L338.1,475.6 L338.7,476.5 L339.4,477.4 L340.0,478.3 L340.7,479.2 L341.3,480.1 L341.9,480.9 L342.6,481.8    L343.2,482.6 L343.9,483.4 L344.5,484.2 L345.1,485.0 L345.8,485.8 L346.4,486.6 L347.1,487.3 L347.7,488.1    L348.3,488.8 L349.0,489.5 L349.6,490.3 L350.3,491.0 L350.9,491.6 L351.6,492.3 L352.2,493.0 L352.8,493.6    L353.5,494.3 L354.1,494.9 L354.8,495.6 L355.4,496.2 L356.0,496.8 L356.7,497.4 L357.3,498.0 L358.0,498.5    L358.6,499.1 L359.2,499.7 L359.9,500.2 L360.5,500.8 L361.2,501.3 L361.8,501.8 L362.5,502.3 L363.1,502.8    L363.7,503.3 L364.4,503.8 L365.0,504.3 L365.7,504.8 L366.3,505.2 L366.9,505.7 L367.6,506.1 L368.2,506.6    L368.9,507.0 L369.5,507.4 L370.2,507.8 L370.8,508.2 L371.4,508.6 L372.1,509.0 L372.7,509.4 L373.4,509.8    L374.0,510.2 L374.6,510.5 L375.3,510.9 L375.9,511.2 L376.6,511.6 L377.2,511.9 L377.8,512.3 L378.5,512.6    L379.1,512.9 L379.8,513.2 L380.4,513.5 L381.1,513.8 L381.7,514.1 L382.3,514.4 L383.0,514.7 L383.6,515.0    L384.3,515.3 L384.9,515.5 L385.5,515.8 L386.2,516.1 L386.8,516.3 L387.5,516.6 L388.1,516.8 L388.7,517.0    L389.4,517.3 L390.0,517.5 L390.7,517.7 L391.3,518.0 L392.0,518.2 L392.6,518.4 L393.2,518.6 L393.9,518.8    L394.5,519.0 L395.2,519.2 L395.8,519.4 L396.4,519.6 L397.1,519.8 L397.7,519.9 L398.4,520.1 L399.0,520.3    L399.7,520.5 L400.3,520.6 L400.9,520.8 L401.6,521.0 L402.2,521.1 L402.9,521.3 L403.5,521.4 L404.1,521.6    L404.8,521.7 L405.4,521.9 L406.1,522.0 L406.7,522.1 L407.3,522.3 L408.0,522.4 L408.6,522.5 L409.3,522.6    L409.9,522.8 L410.6,522.9 L411.2,523.0 L411.8,523.1 L412.5,523.2 L413.1,523.3 L413.8,523.4 L414.4,523.5    L415.0,523.6 L415.7,523.7 L416.3,523.8 L417.0,523.9 L417.6,524.0 L418.2,524.1 L418.9,524.2 L419.5,524.3    L420.2,524.4 L420.8,524.5 L421.5,524.6 L422.1,524.6 L422.7,524.7 L423.4,524.8 L424.0,524.9 L424.7,524.9    L425.3,525.0 L425.9,525.1 L426.6,525.2 L427.2,525.2 L427.9,525.3 L428.5,525.3 L429.2,525.4 L429.8,525.5    L430.4,525.5 L431.1,525.6 L431.7,525.6 L432.4,525.7 L433.0,525.8 L433.6,525.8 L434.3,525.9 L434.9,525.9    L435.6,526.0 L436.2,526.0 L436.8,526.1 L437.5,526.1 L438.1,526.2 L438.8,526.2 L439.4,526.2 L440.1,526.3    L440.7,526.3 L441.3,526.4 L442.0,526.4 L442.6,526.4 L443.3,526.5 L443.9,526.5 L444.5,526.6 L445.2,526.6    L445.8,526.6 L446.5,526.7 L447.1,526.7 L447.7,526.7 L448.4,526.8 L449.0,526.8 L449.7,526.8 L450.3,526.8    L451.0,526.9 L451.6,526.9 L452.2,526.9 L452.9,527.0 L453.5,527.0 L454.2,527.0 L454.8,527.0 L455.4,527.1    L456.1,527.1 L456.7,527.1 L457.4,527.1 L458.0,527.1 L458.6,527.2 L459.3,527.2 L459.9,527.2 L460.6,527.2    L461.2,527.2 L461.9,527.3 L462.5,527.3 L463.1,527.3 L463.8,527.3 L464.4,527.3 L465.1,527.4 L465.7,527.4    L466.3,527.4 L467.0,527.4 L467.6,527.4 L468.3,527.4 L468.9,527.4 L469.6,527.5 L470.2,527.5 L470.8,527.5    L471.5,527.5 L472.1,527.5 L472.8,527.5 L473.4,527.5 L474.0,527.6 L474.7,527.6 L475.3,527.6 L476.0,527.6    L476.6,527.6 L477.2,527.6 L477.9,527.6 L478.5,527.6 L479.2,527.6 L479.8,527.6 L480.5,527.7 L481.1,527.7    L481.7,527.7 L482.4,527.7 L483.0,527.7 L483.7,527.7 L484.3,527.7 L484.9,527.7 L485.6,527.7 L486.2,527.7    L486.9,527.7 L487.5,527.7 L488.1,527.7 L488.8,527.8 L489.4,527.8 L490.1,527.8 L490.7,527.8 L491.4,527.8    L492.0,527.8 L492.6,527.8 L493.3,527.8 L493.9,527.8 L494.6,527.8 L495.2,527.8 L495.8,527.8 L496.5,527.8    L497.1,527.8 L497.8,527.8 L498.4,527.8 L499.1,527.8 L499.7,527.8 L500.3,527.8 L501.0,527.9 L501.6,527.9    L502.3,527.9 L502.9,527.9 L503.5,527.9 L504.2,527.9 L504.8,527.9 L505.5,527.9 L506.1,527.9 L506.7,527.9    L507.4,527.9 L508.0,527.9 L508.7,527.9 L509.3,527.9 L510.0,527.9 L510.6,527.9 L511.2,527.9 L511.9,527.9    L512.5,527.9 L513.2,527.9 L513.8,527.9 L514.4,527.9 L515.1,527.9 L515.7,527.9 L516.4,527.9 L517.0,527.9    L517.6,527.9 L518.3,527.9 L518.9,527.9 L519.6,527.9 L520.2,527.9 L520.9,527.9 L521.5,527.9 L522.1,527.9    L522.8,527.9 L523.4,527.9 L524.1,527.9 L524.7,527.9 L525.3,527.9 L526.0,527.9 L526.6,528.0 L527.3,528.0    L527.9,528.0 L528.6,528.0 L529.2,528.0 L529.8,528.0 L530.5,528.0 L531.1,528.0 L531.8,528.0 L532.4,528.0    L533.0,528.0 L533.7,528.0 L534.3,528.0 L535.0,528.0 L535.6,528.0 L536.2,528.0 L536.9,528.0 L537.5,528.0    L538.2,528.0 L538.8,528.0 L539.5,528.0 L540.1,528.0 L540.7,528.0 L541.4,528.0 L542.0,528.0 L542.7,528.0    L543.3,528.0 L543.9,528.0 L544.6,528.0 L545.2,528.0 L545.9,528.0 L546.5,528.0 L547.1,528.0 L547.8,528.0    L548.4,528.0 L549.1,528.0 L549.7,528.0 L550.4,528.0 L551.0,528.0 L551.6,528.0 L552.3,528.0 L552.9,528.0    L553.6,528.0 L554.2,528.0 L554.8,528.0 L555.5,528.0 L556.1,528.0 L556.8,528.0 L557.4,528.0 L558.1,528.0    L558.7,528.0 L559.3,528.0 L560.0,528.0 L560.6,528.0 L561.3,528.0 L561.9,528.0 L562.5,528.0 L563.2,528.0    L563.8,528.0 L564.5,528.0 L565.1,528.0 L565.7,528.0 L566.4,528.0 L567.0,528.0 L567.7,528.0 L568.3,528.0    L569.0,528.0 L569.6,528.0 L570.2,528.0 L570.9,528.0 L571.5,528.0 L572.2,528.0 L572.8,528.0 L573.4,528.0    L574.1,528.0 L574.7,528.0 L575.4,528.0 L576.0,528.0 L576.6,528.0 L577.3,528.0 L577.9,528.0 L578.6,528.0    L579.2,528.0 L579.9,528.0 L580.5,528.0 L581.1,528.0 L581.8,528.0 L582.4,528.0 L583.1,528.0 L583.7,528.0    L584.3,528.0 L585.0,528.0 L585.6,528.0 L586.3,528.0 L586.9,528.0 L587.6,528.0 L588.2,528.0 L588.8,528.0    L589.5,528.0 L590.1,528.0 L590.8,528.0 L591.4,528.0 L592.0,528.0 L592.7,528.0 L593.3,528.0 L594.0,528.0    L594.6,528.0 L595.2,528.0 L595.9,528.0 L596.5,528.0 L597.2,528.0 L597.8,528.0 L598.5,528.0 L599.1,528.0    L599.7,528.0 L600.4,528.0 L601.0,528.0 L601.7,528.0 L602.3,528.0 L602.9,528.0 L603.6,528.0 L604.2,528.0    L604.9,528.0 L605.5,528.0 L606.1,528.0 L606.8,528.0 L607.4,528.0 L608.1,528.0 L608.7,528.0 L609.4,528.0    L610.0,528.0 L610.6,528.0 L611.3,528.0 L611.9,528.0 L612.6,528.0 L613.2,528.0 L613.8,528.0 L614.5,528.0    L615.1,528.0 L615.8,528.0 L616.4,528.0 L617.1,528.0 L617.7,528.0 L618.3,528.0 L619.0,528.0 L619.6,528.0    L620.3,528.0 L620.9,528.0 L621.5,528.0 L622.2,528.0 L622.8,528.0 L623.5,528.0 L624.1,528.0 L624.7,528.0    L625.4,528.0 L626.0,528.0 L626.7,528.0 L627.3,528.0 L628.0,528.0 L628.6,528.0 L629.2,528.0 L629.9,528.0    L630.5,528.0 L631.2,528.0 L631.8,528.0 L632.4,528.0 L633.1,528.0 L633.7,528.0 L634.4,528.0 L635.0,528.0    L635.6,528.0 L636.3,528.0 L636.9,528.0 L637.6,528.0 L638.2,528.0 L638.9,528.0 L639.5,528.0 L640.1,528.0    L640.8,528.0 L641.4,528.0 L642.1,528.0 L642.7,528.0 L643.3,528.0 L644.0,528.0 L644.6,528.0 L645.3,528.0    L645.9,528.0 L646.6,528.0 L647.2,528.0 L647.8,528.0 L648.5,528.0 L649.1,528.0 L649.8,528.0 L650.4,528.0    L651.0,528.0 L651.7,528.0 L652.3,528.0 L653.0,528.0 L653.6,528.0 L654.2,528.0 L654.9,528.0 L655.5,528.0    L656.2,528.0 L656.8,528.0 L657.5,528.0 L658.1,528.0 L658.7,528.0 L659.4,528.0 L660.0,528.0 L660.7,528.0    L661.3,528.0 L661.9,528.0 L662.6,528.0 L663.2,528.0 L663.9,528.0 L664.5,528.0 L665.1,528.0 L665.8,528.0    L666.4,528.0 L667.1,528.0 L667.7,528.0 L668.4,528.0 L669.0,528.0 L669.6,528.0 L670.3,528.0 L670.9,528.0    L671.6,528.0 L672.2,528.0 L672.8,528.0 L673.5,528.0 L674.1,528.0 L674.8,528.0 L675.4,528.0 L676.1,528.0    L676.7,528.0 L677.3,528.0 L678.0,528.0 L678.6,528.0 L679.3,528.0 L679.9,528.0 L680.5,528.0 L681.2,528.0    L681.8,528.0 L682.5,528.0 L683.1,528.0 L683.7,528.0 L684.4,528.0 L685.0,528.0 L685.7,528.0 L686.3,528.0    L687.0,528.0 L687.6,528.0 L688.2,528.0 L688.9,528.0 L689.5,528.0 L690.2,528.0 L690.8,528.0 L691.4,528.0    L692.1,528.0 L692.7,528.0 L693.4,528.0 L694.0,528.0 L694.6,528.0 L695.3,528.0 L695.9,528.0 L696.6,528.0    L697.2,528.0 L697.9,528.0 L698.5,528.0 L699.1,528.0 L699.8,528.0 L700.4,528.0 L701.1,528.0 L701.7,528.0    L702.3,528.0 L703.0,528.0 L703.6,528.0 L704.3,528.0 L704.9,528.0 L705.6,528.0 L706.2,528.0 L706.8,528.0    L707.5,528.0 L708.1,528.0 L708.8,528.0 L709.4,528.0 L710.0,528.0 L710.7,528.0 L711.3,528.0 L712.0,528.0    L712.6,528.0 L713.2,528.0 L713.9,528.0 L714.5,528.0 L715.2,528.0 L715.8,528.0 L716.5,528.0 L717.1,528.0    L717.7,528.0 L718.4,528.0 L719.0,528.0 L719.7,528.0 L720.3,528.0 L720.9,528.0 L721.6,528.0 L722.2,528.0    L722.9,528.0 L723.5,528.0 L724.1,528.0 L724.8,528.0 L725.4,528.0 L726.1,528.0 L726.7,528.0 L727.4,528.0    L728.0,528.0 L728.6,528.0 L729.3,528.0 L729.9,528.0 L730.6,528.0 L731.2,528.0 L731.8,528.0 L732.5,528.0    L733.1,528.0 L733.8,528.0 L734.4,528.0 L735.1,528.0 L735.7,528.0 L736.3,528.0 L737.0,528.0 L737.6,528.0    L738.3,528.0 L738.9,528.0 L739.5,528.0 L740.2,528.0 L740.8,528.0 L741.5,528.0 L742.1,528.0 L742.7,528.0    L743.4,528.0 L744.0,528.0 L744.7,528.0 L745.3,528.0 L746.0,528.0 L746.6,528.0 L747.2,528.0 L747.9,528.0    L748.5,528.0 L749.2,528.0 L749.8,528.0  h0.01"
        id="path4217"
      />
    </motion.svg>
  );
};
